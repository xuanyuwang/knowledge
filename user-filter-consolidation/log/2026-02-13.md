# Project Log - 2026-02-13

## Progress

- Fixed gocritic `ifElseChain` lint failure in CI — converted two if-else chains to switch statements in test runner
- Integrated CONVI-6260 finding (child group expansion bug) into behavioral standard, implementation plan, and Phase 1 tests

## Details

### CI Lint Fix

PR #25705 CI "Run go lints" job failed with two `gocritic: ifElseChain` errors at lines 471 and 484 of `common_user_filter_test.go`. The test runner's ground truth setup and ACL setup used if-else chains that the linter requires to be switch statements. Converted both to `switch {}` blocks. Committed as `7234fdce62`.

### CONVI-6260: Child Group Expansion Bug

The CONVI-6260 investigation (separate project) found that `buildUserGroupMappings` in `ParseUserFilterForAnalytics` uses `FetchGroups` which only returns explicitly-requested group IDs — it does NOT expand child/sub-teams like the old path's `ListGroups` does. This means when a parent team is selected for a team leaderboard, `GroupsToAggregate` only contains the parent, and the leaderboard shows one row instead of rows per sub-team.

Updates made:

1. **Behavioral standard** (`user-filter-behavioral-standard.md`):
   - Added **B-GH-4**: "Child Teams Must Appear in GroupsToAggregate" — documents the required behavior and the current bug
   - Added **Divergence 10**: "Child Group Expansion in GroupsToAggregate" — documents the `FetchGroups` vs `ListGroups` difference
   - Renumbered old B-GH-4 (cross-profile safety) to B-GH-5
   - Updated Appendix B (behaviors not covered by tests) to list B-GH-4 separately from B-GH-1–3

2. **Implementation plan** (`implementation-plan.md`):
   - Added B-GH-4 to PR 1.3 scope (group mechanics tests)
   - Added "Critical fix" note to PR 3.3 (group membership tracking) about child group expansion requirement
   - Updated PR 3.4 to mention B-GH-4 test should pass with unified implementation

3. **Phase 1 test** (PR #25705, commit `bddec7263b`):
   - Added `B_GH_4_ChildTeamsMissingFromGroupsToAggregateBug` test case to `behavioralGroupMechanicsTests()`
   - Test sets up: parent team selected, 3 agents each in different sub-teams with indirect parent membership
   - Asserts current (broken) behavior: `GroupsToAggregate` has only 1 entry (parent), sub-teams missing
   - Comments document what the correct behavior should be for the unified implementation
