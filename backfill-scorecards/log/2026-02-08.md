# Project Log - 2026-02-08

## Progress

- [x] Check status of 260 temporal jobs started yesterday
- [x] Identify any failed jobs - **None failed!**
- [ ] Re-run failed jobs if needed - N/A

## Details

### Job Summary from Yesterday (2026-02-07)

| Cluster | Jobs Created |
|---------|-------------|
| us-east-1-prod | 86 |
| us-west-2-prod | 80 |
| voice-prod | 49 |
| chat-prod | 28 |
| eu-west-2-prod | 6 |
| schwab-prod | 5 |
| ap-southeast-2-prod | 4 |
| ca-central-1-prod | 2 |
| **Total** | **260** |

### Status Check (2026-02-08 ~11:00 UTC)

| Cluster | Total | Completed | Running | Failed | TimedOut |
|---------|-------|-----------|---------|--------|----------|
| us-east-1-prod | 300* | 294 | 6 | 0 | 0 |
| us-west-2-prod | 300* | 295 | 5 | 0 | 0 |
| voice-prod | 300* | 298 | 2 | 0 | 0 |
| chat-prod | 60 | 60 | 0 | 0 | 0 |
| ap-southeast-2-prod | 4 | 4 | 0 | 0 | 0 |
| ca-central-1-prod | 2 | 2 | 0 | 0 | 0 |
| eu-west-2-prod | 6 | 6 | 0 | 0 | 0 |
| schwab-prod | 21 | 21 | 0 | 0 | 0 |

*Total exceeds our job count because query includes other reindex jobs started on same day (daily scheduled runs).

### Final Status of Our 260 Backfill Jobs (checked 2026-02-08 19:10 UTC)

| Status | Count |
|--------|-------|
| **Completed** | 256 |
| **Failed** | 4 |

### Key Findings

1. **256 completed successfully** (98.5%)
2. **4 failed** - all large customers with high conversation volume

### Failed Jobs Details

| Customer | Cluster | Conversations Processed | Total | Failure Reason |
|----------|---------|------------------------|-------|----------------|
| marriott | us-east-1-prod | 1,309,300 | ? | Heartbeat timeout |
| united-east | us-east-1-prod | 578,100 | ? | Heartbeat timeout |
| cvs | us-west-2-prod | 2,415,600 | 4,182,259 (57.8%) | **Deadlock** (SQLSTATE 40P01) |
| oportun | us-west-2-prod | 1,186,200 | 2,629,588 (45.1%) | **Deadlock** (SQLSTATE 40P01) |

**Root causes:**
1. **Heartbeat timeout** - Activity took too long between heartbeats (marriott, united-east)
2. **Database deadlock** - Concurrent writes caused PostgreSQL deadlock (cvs, oportun)

### Long-Running Backfill Workflows (from our 2026-02-07 backfill)

These 4 workflows have been running 23+ hours - they are processing large customers:

| Customer | Cluster | Workflow ID | State Transitions | Status |
|----------|---------|-------------|-------------------|--------|
| marriott | us-east-1-prod | `reindexconversations-marriott-us-east-1-d4ef120c-...` | 1720 | Active (ReindexConversationsActivity) |
| united-east | us-east-1-prod | `reindexconversations-united-east-us-east-1-643a33eb-...` | 1717 | Active (ReindexConversationsActivity) |
| cvs | us-west-2-prod | `reindexconversations-cvs-us-west-2-7351911d-...` | 1698 | Active (ReindexConversationsActivity) |
| oportun | us-west-2-prod | `reindexconversations-oportun-us-west-2-b8e37683-...` | 1698 | Active (ReindexConversationsActivity) |

**Note:** High StateTransitionCount (~1700) indicates they are actively processing/heartbeating, not stuck.

### Other Running Workflows (newer, likely daily scheduled)

- spirit (us-east-1-prod) - 2 workflows, started recently
- united-east (us-east-1-prod) - 4 workflows, started 51min-3hrs ago
- cvs (us-west-2-prod) - 3 workflows, started 27min-1hr ago
- hilton (voice-prod) - 2 workflows, started 7-53min ago

### Retry Jobs (2026-02-08 19:24 UTC)

Re-ran the 4 failed customers using `./rerun_failed.sh`:

| Customer | Cluster | New Workflow ID |
|----------|---------|-----------------|
| united-east | us-east-1-prod | `reindexconversations-united-east-us-east-1-24206ab8-...` |
| marriott | us-east-1-prod | `reindexconversations-marriott-us-east-1-16ee7a2a-...` |
| cvs | us-west-2-prod | `reindexconversations-cvs-us-west-2-2a41185b-...` |
| oportun | us-west-2-prod | `reindexconversations-oportun-us-west-2-e39c65ef-...` |

### Next Steps

- [x] Retry the 4 failed jobs
- [ ] Monitor retry jobs for completion
- [ ] If deadlocks recur, escalate to infrastructure team

