# Project Log - 2026-02-12

## Progress

- Reorganized project documents: consolidated 14 scattered files into clean structure
- Starting implementation for CONVI-6097: add `excludeDeactivatedUsers` filter to `RetrieveCoachingSessionStats`
- CONVI-6242: Completed code changes (`task.go`, `task_test.go`) — filter by `ended_at` instead of `created_at`
- CONVI-6242: Fixed event fetch window to use `max(EndTime)` for upper bound (PR review feedback)
- CONVI-6242: Created and merged go-servers [#25706](https://github.com/cresta/go-servers/pull/25706)
- CONVI-6242: Closed clickhouse-schema [#172](https://github.com/cresta/clickhouse-schema/pull/172) — ORDER BY change not needed for correctness
- CONVI-6242: Done — cleaned up worktree and branch
- Created [convi-6242-stale-labels-fix.md](../convi-6242-stale-labels-fix.md) with complete fix plan

## Details

### Document Reorganization

**Before:** 14 files at root level mixing different bugs, investigations, and reference docs
**After:**
```
README.md                              # Entry point - all bugs, status, links
convi-6242-stale-labels-fix.md         # CONVI-6242 full fix plan
reference/
  coaching-efficiency-api.md           # API behavior reference
  database-model.md                    # DB schema reference
log/
  2026-02-12.md                        # Daily log
```

### CONVI-6097 Implementation Plan

Root cause: `RetrieveCoachingSessionStats` doesn't respect `excludeDeactivatedUsers` filter.
Need to add user active state filtering, matching the behavior in `RetrieveCoachingEfficiencyStats`.

### CONVI-6242: cron-label-conversations stale labels fix

**Code changes done** in `go-servers-convi-6242/cron/sync-users/internal/conversation-agent-assistance/`:

1. **`task.go`** — `findConversations` filter: `created_at` → `ended_at` + `IS NOT NULL`; watermark: `max(conversation_start_time)` → `max(conversation_end_time)`; event window upper bound: `maxConvStartTime` → `maxConvEndTime`
2. **`task_test.go`** — Updated `TestSetTimeRange` assertions for new watermark column

**ClickHouse schema migration NOT needed** — since a conversation can only end once, `conversation_end_time` and `agent_user_id` are final when the cron processes it. Each conversation is written exactly once. The ORDER BY change to `conversation_start_time` could be a future performance optimization but isn't required for correctness.

**PRs:**
- go-servers [#25706](https://github.com/cresta/go-servers/pull/25706) — merged
- clickhouse-schema [#172](https://github.com/cresta/clickhouse-schema/pull/172) — closed (not needed)

Full details: see [convi-6242-stale-labels-fix.md](../convi-6242-stale-labels-fix.md)
