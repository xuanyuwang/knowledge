# Project Log - 2026-02-17

## Progress

- Created project folder `agent-quintiles-support/` and initial README + investigation doc.
- Investigated (1) how agents are divided into tiers in RetrieveQAScoreStats (BE), (2) Performance page agent tables and how to add Quintile Rank column, (3) how Leaderboard and Coaching Hub get agent data and where to show quintile icons.

## Details

### Backend (go-servers)

- **API**: RetrieveQAScoreStats (not RetrieveQAStats). Implemented in `insights-server/internal/analyticsimpl/retrieve_qa_score_stats.go`.
- **Quintiles = score bands (not volume percentiles):** Q1 = 80+, Q2 = 60–79, Q3 = 40–59, Q4 = 20–39, Q5 = 0–19 (0–100 scale; backend uses 0–1).
- Proto: add `quintile_rank` (int32 1–5) to `QAScoreGroupBy`. Set via `ScoreToQuintileRank(score)` when returning per-agent scores.
- Concrete BE plan in `implementation-plan.md`: helper `setQuintileRankForPerAgentScores`, call before appendGroupMemberships; set in ClickHouse converter loop.

### Frontend (director)

- **Performance page**: Performance.tsx → PerformanceProgression, LeaderboardByScorecardTemplateItem (Agent tab), LeaderboardPerCriterion. Data from useQAScoreStats (RetrieveQAScoreStats). Add column that reads `groupedBy.quintileRank` once BE returns it.
- **Leaderboard**: AgentLeaderboard and AgentLeaderboardByMetric build rows from agentStats + qaScoreResult.scores. Can attach quintile from score to row and render a colored icon (shared component).
- **Coaching Hub**: CriteriaGoalSnapshot and other tabs; need to get per-agent QA stats (with quintile) and show same icon for each agent.

### Worktrees

- User requested: when working on BE (~/repos/go-servers) or FE (~/repos/director), create a new worktree. Documented in README and investigation.

## Next Steps

1. **BE (Phase 1):** Proto add `quintile_rank` → implement `ScoreToQuintileRank` + `setQuintileRankForPerAgentScores` → wire in retrieve_qa_score_stats.go and retrieve_qa_score_stats_clickhouse.go → add tests. See implementation-plan.md.
2. **FE (Phase 2):** Add Quintile Rank column to Performance tables; quintile icons on Leaderboard + Coaching Hub (refine when FE requirements are set).

## Related

- go-servers: insights-server/internal/analyticsimpl/retrieve_qa_score_stats.go, shared/utils/partition.go
- director: qa-insights/performance, leaderboard-by-scorecard-template-item, insights/leaderboard/agent-leaderboard, coaching-hub
- cresta-proto: cresta/v1/analytics/qa_stats.proto
