# Project Log - 2026-02-20

## Progress

- Reverted `getFilterSelectionMenuOptions()` function back to static `FILTER_SELECTION_MENU_OPTIONS` constant (per review feedback — BooleanFilter label is already translated via `useTranslation` in the hook, so wrapping menu options isn't needed).
- Changed plan: wire up API requests per page alongside UI (no feature flag → visible filter that doesn't work would confuse users).
- Wired `listAgentOnly` into all Performance page API requests (Phase 3b).
- Addressed PR review comments (cursor[bot]): added `?? true` fallback in Performance `localStateToFilterState`.
- Updated PR #16777 description to include Phase 3b.

## Details

### Plan change: UI + API wiring together

Since there's no feature flag, having the filter visible without it actually affecting API requests would be confusing. Updated approach: add UI and wire API requests for each page together.

### Phase 3b — Wire API requests on Performance page (5 files)

1. **`packages/director-api/src/services/cresta-api/insights/types.ts`**:
   - Added `| 'filterToAgentsOnly'` to `QAScoreStatsRequestParams` Pick type

2. **`packages/director-app/src/components/insights/hooks/util-hooks/useQAScoreStatsRequestParams.ts`**:
   - Added `filterToAgentsOnly: filtersState.listAgentOnly` in `getQAScoreStatsRequestParams` return object
   - This flows to all QA score stats calls automatically (score breakdown, per-agent scores, etc.)

3. **`ConversationCountChart.tsx`**:
   - Added 5th param `{ filterToAgentsOnly: filtersState.listAgentOnly }` to `useInsightsRequestParams`

4. **`AverageHandleTimeInsightsMetric.tsx`**:
   - Created memoized `filterOptions` object with `filterToAgentsOnly: filters.listAgentOnly`
   - Passed as 5th arg to all 3 `useInsightsRequestParams` calls (current, delta, forAll)

5. **`AverageHandleTimeChartGraph.tsx`**:
   - Added `{ filterToAgentsOnly: filters.listAgentOnly }` as 5th param to `useInsightsRequestParams`

### Revert: static FILTER_SELECTION_MENU_OPTIONS

- `utils.ts`: Reverted from `getFilterSelectionMenuOptions()` function back to static `FILTER_SELECTION_MENU_OPTIONS` constant
- The i18n for the BooleanFilter label is already handled by `useTranslation` in `usePerformanceFilters.tsx`; the menu options don't need translation wrapping

## Next Steps

- Phase 4: Leaderboard page — add filter UI + wire API requests (same BooleanFilter pattern, disable on Manager tab)
- Phase 6: Agent Assist page (TBD if in scope)
